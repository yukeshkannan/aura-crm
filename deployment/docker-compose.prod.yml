services:
  caddy:
    image: caddy:2-alpine
    restart: always
    ports:
      - "80:80"
      - "443:443"
    environment:
      - DOMAIN_NAME=${DOMAIN_NAME}
    volumes:
      - ./deployment/Caddyfile:/etc/caddy/Caddyfile
      - caddy_data:/data
      - caddy_config:/config
    networks:
      - aura-network
    depends_on:
      - gateway

  gateway:
    build: { context: ., dockerfile: apps/gateway/Dockerfile }
    environment:
      - PORT=5000
      - AUTH_SERVICE_URL=http://auth-service:5001
      - CONTACT_SERVICE_URL=http://contact-service:5002
      - OPPORTUNITY_SERVICE_URL=http://opportunity-service:5003
      - TASK_SERVICE_URL=http://task-service:5004
      - NOTIFICATION_SERVICE_URL=http://notification-service:5005
      - ANALYTICS_SERVICE_URL=http://analytics-service:5006
      - DOCUMENT_SERVICE_URL=http://document-service:5007
      - PRODUCT_SERVICE_URL=http://product-service:5008
      - INVOICE_SERVICE_URL=http://invoice-service:5009
      - TICKET_SERVICE_URL=http://ticket-service:5010
      - SEARCH_SERVICE_URL=http://search-service:5011
      - HR_SERVICE_URL=http://hr-service:5012
    networks: [ aura-network ]
    restart: always

  auth-service:
    build: { context: ., dockerfile: apps/auth-service/Dockerfile }
    environment:
      - MONGO_URI=${MONGO_URI}
      - JWT_SECRET=${JWT_SECRET}
      - BREVO_API_KEY=${BREVO_API_KEY}
      - SENDER_EMAIL=${SENDER_EMAIL}
    networks: [ aura-network ]
    restart: always

  contact-service:
    build: { context: ., dockerfile: apps/contact-service/Dockerfile }
    environment: [ "MONGO_URI=${MONGO_URI}" ]
    networks: [ aura-network ]
    restart: always

  opportunity-service:
    build: { context: ., dockerfile: apps/opportunity-service/Dockerfile }
    environment: [ "MONGO_URI=${MONGO_URI}" ]
    networks: [ aura-network ]
    restart: always

  task-service:
    build: { context: ., dockerfile: apps/task-service/Dockerfile }
    environment: [ "MONGO_URI=${MONGO_URI}" ]
    networks: [ aura-network ]
    restart: always

  notification-service:
    build: { context: ., dockerfile: apps/notification-service/Dockerfile }
    environment:
      - MONGO_URI=${MONGO_URI}
      - BREVO_API_KEY=${BREVO_API_KEY}
      - SENDER_EMAIL=${SENDER_EMAIL}
    networks: [ aura-network ]
    restart: always

  analytics-service:
    build: { context: ., dockerfile: apps/analytics-service/Dockerfile }
    environment:
      - MONGO_URI=${MONGO_URI}
      - CONTACT_SERVICE_URL=http://contact-service:5002
      - OPPORTUNITY_SERVICE_URL=http://opportunity-service:5003
      - TASK_SERVICE_URL=http://task-service:5004
      - INVOICE_SERVICE_URL=http://invoice-service:5009
      - TICKET_SERVICE_URL=http://ticket-service:5010
    networks: [ aura-network ]
    restart: always

  document-service:
    build: { context: ., dockerfile: apps/document-service/Dockerfile }
    environment:
      - MONGO_URI=${MONGO_URI}
      - STORAGE_TYPE=${STORAGE_TYPE:-local}
      - AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}
      - AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}
      - AWS_REGION=${AWS_REGION:-ap-south-1}
      - AWS_BUCKET_NAME=${AWS_BUCKET_NAME}
    networks: [ aura-network ]
    restart: always

  product-service:
    build: { context: ., dockerfile: apps/product-service/Dockerfile }
    environment: [ "MONGO_URI=${MONGO_URI}" ]
    networks: [ aura-network ]
    restart: always

  invoice-service:
    build: { context: ., dockerfile: apps/invoice-service/Dockerfile }
    environment: [ "MONGO_URI=${MONGO_URI}" ]
    networks: [ aura-network ]
    restart: always

  ticket-service:
    build: { context: ., dockerfile: apps/ticket-service/Dockerfile }
    environment: [ "MONGO_URI=${MONGO_URI}" ]
    networks: [ aura-network ]
    restart: always

  search-service:
    build: { context: ., dockerfile: apps/search-service/Dockerfile }
    environment: [ "MONGO_URI=${MONGO_URI}" ]
    networks: [ aura-network ]
    restart: always

  hr-service:
    build: { context: ., dockerfile: apps/hr-service/Dockerfile }
    environment: [ "MONGO_URI=${MONGO_URI}" ]
    networks: [ aura-network ]
    restart: always

volumes:
  caddy_data:
  caddy_config:


networks:
  aura-network:
    driver: bridge
